(()=>{var t={n:a=>{var e=a&&a.__esModule?()=>a.default:()=>a;return t.d(e,{a:e}),e},d:(a,e)=>{for(var s in e)t.o(e,s)&&!t.o(a,s)&&Object.defineProperty(a,s,{enumerable:!0,get:e[s]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},a={};(()=>{"use strict";t.r(a);const e=flarum.core.compat["common/app"];t.n(e)().initializers.add("wszdb/flarumaichat",(function(){}));const s=flarum.core.compat["admin/app"];var n=t.n(s);function r(t,a){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,a){return t.__proto__=a,t},r(t,a)}const i=flarum.core.compat["admin/components/ExtensionPage"];var l=t.n(i);const o=flarum.core.compat["common/components/Button"];var d=t.n(o),c=["gpt-4.5-preview","gpt-4o","gpt-4o-mini","gpt-4-turbo","gpt-4","gpt-3.5-turbo","gpt-3.5-turbo-instruct","o1-preview","o1-mini","chatgpt-4o-latest"],u=function(t){var a,e;function s(){for(var a,e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return(a=t.call.apply(t,[this].concat(s))||this).loading=void 0,a.isFetchingModels=void 0,a.models=void 0,a}e=t,(a=s).prototype=Object.create(e.prototype),a.prototype.constructor=a,r(a,e);var i=s.prototype;return i.oninit=function(a){t.prototype.oninit.call(this,a),this.loading=!1,this.isFetchingModels=!1,this.models=this.getModels()},i.getModels=function(){try{var t=n().data.settings["wszdb-flarumaichat.cached_models"];if(t&&"[]"!==t){var a=JSON.parse(t);if(Array.isArray(a)&&a.length>0)return a.reduce((function(t,a){return t[a.id]=a.id,t}),{})}}catch(t){console.error("Failed to parse cached models:",t)}return c.reduce((function(t,a){return t[a]=a,t}),{})},i.fetchModels=function(){var t=this;this.isFetchingModels=!0,n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/chatgpt/fetch-models"}).then((function(a){t.isFetchingModels=!1,n().data.settings["wszdb-flarumaichat.cached_models"]=JSON.stringify(a.models),n().data.settings["wszdb-flarumaichat.models_last_fetched"]=a.last_fetched.toString(),t.models=t.getModels(),n().alerts.show({type:"success"},n().translator.trans("wszdb-flarumaichat.admin.settings.models_fetched_success",{count:a.count})),m.redraw()}),(function(a){t.isFetchingModels=!1,n().alerts.show({type:"error"},n().translator.trans("wszdb-flarumaichat.admin.settings.fetch_models_error")),m.redraw()}))},i.getLastFetchedText=function(){var t=parseInt(n().data.settings["wszdb-flarumaichat.models_last_fetched"]||"0");if(0===t)return n().translator.trans("wszdb-flarumaichat.admin.settings.models_never_fetched");var a=new Date(1e3*t);return n().translator.trans("wszdb-flarumaichat.admin.settings.models_last_fetched",{date:a.toLocaleString()})},i.content=function(){var t=this;return m("div",{className:"ExtensionPage-settings"},m("div",{className:"container"},m("div",{className:"Form"},this.buildSettingComponent({setting:"wszdb-flarumaichat.api_key",type:"text",label:n().translator.trans("wszdb-flarumaichat.admin.settings.api_key_label"),help:n().translator.trans("wszdb-flarumaichat.admin.settings.api_key_help",{a:m("a",{href:"https://platform.openai.com/account/api-keys",target:"_blank",rel:"noopener"})}),placeholder:"sk-..."}),this.buildSettingComponent({setting:"wszdb-flarumaichat.base_uri",type:"text",label:n().translator.trans("wszdb-flarumaichat.admin.settings.base_uri_label"),help:n().translator.trans("wszdb-flarumaichat.admin.settings.base_uri_help"),placeholder:"api.openai.com"}),this.buildSettingComponent({setting:"wszdb-flarumaichat.model",type:"dropdown",options:this.models,label:n().translator.trans("wszdb-flarumaichat.admin.settings.model_label"),help:n().translator.trans("wszdb-flarumaichat.admin.settings.model_help",{a:m("a",{href:"https://platform.openai.com/docs/models/overview",target:"_blank",rel:"noopener"})})}),m("div",{className:"Form-group"},m("label",null,n().translator.trans("wszdb-flarumaichat.admin.settings.fetch_models_label")),m("div",null,m(d(),{className:"Button Button--primary",onclick:function(){return t.fetchModels()},loading:this.isFetchingModels,disabled:this.isFetchingModels},n().translator.trans("wszdb-flarumaichat.admin.settings.fetch_models_button")),m("p",{className:"helpText"},this.getLastFetchedText()))),this.buildSettingComponent({setting:"wszdb-flarumaichat.max_tokens",type:"number",label:n().translator.trans("wszdb-flarumaichat.admin.settings.max_tokens_label"),help:n().translator.trans("wszdb-flarumaichat.admin.settings.max_tokens_help",{a:m("a",{href:"https://help.openai.com/en/articles/4936856",target:"_blank",rel:"noopener"})}),default:100}),this.buildSettingComponent({setting:"wszdb-flarumaichat.moderation",type:"boolean",label:n().translator.trans("wszdb-flarumaichat.admin.settings.moderation_label"),help:n().translator.trans("wszdb-flarumaichat.admin.settings.moderation_help")}),this.buildSettingComponent({setting:"wszdb-flarumaichat.user_prompt",type:"text",label:n().translator.trans("wszdb-flarumaichat.admin.settings.user_prompt_label"),help:n().translator.trans("wszdb-flarumaichat.admin.settings.user_prompt_help")}),this.buildSettingComponent({setting:"wszdb-flarumaichat.role",type:"text",label:n().translator.trans("wszdb-flarumaichat.admin.settings.role_label"),help:n().translator.trans("wszdb-flarumaichat.admin.settings.role_help")}),this.buildSettingComponent({setting:"wszdb-flarumaichat.prompt",type:"text",label:n().translator.trans("wszdb-flarumaichat.admin.settings.prompt_label"),help:n().translator.trans("wszdb-flarumaichat.admin.settings.prompt_help")}),this.buildSettingComponent({setting:"wszdb-flarumaichat.user_prompt_badge_text",type:"text",label:n().translator.trans("wszdb-flarumaichat.admin.settings.user_prompt_badge_label"),help:n().translator.trans("wszdb-flarumaichat.admin.settings.user_prompt_badge_help")}),this.buildSettingComponent({setting:"wszdb-flarumaichat.queue_active",type:"boolean",label:n().translator.trans("wszdb-flarumaichat.admin.settings.queue_active_label"),help:n().translator.trans("wszdb-flarumaichat.admin.settings.queue_active_help")}),this.buildSettingComponent({setting:"wszdb-flarumaichat.answer_duration",type:"number",label:n().translator.trans("wszdb-flarumaichat.admin.settings.answer_duration_label")}),this.buildSettingComponent({setting:"wszdb-flarumaichat.enable_on_reply",type:"boolean",label:n().translator.trans("wszdb-flarumaichat.admin.settings.enable_on_reply_label")}),this.buildSettingComponent({setting:"wszdb-flarumaichat.enable_on_discussion_started",type:"boolean",label:n().translator.trans("wszdb-flarumaichat.admin.settings.enable_on_discussion_started_label"),help:n().translator.trans("wszdb-flarumaichat.admin.settings.enable_on_discussion_started_help")}),this.buildSettingComponent({setting:"wszdb-flarumaichat.continue_to_reply",type:"boolean",label:n().translator.trans("wszdb-flarumaichat.admin.settings.continue_to_reply_label"),help:n().translator.trans("wszdb-flarumaichat.admin.settings.continue_to_reply_help")}),this.buildSettingComponent({setting:"wszdb-flarumaichat.continue_to_reply_count",type:"number",label:n().translator.trans("wszdb-flarumaichat.admin.settings.continue_to_reply_count_label"),help:n().translator.trans("wszdb-flarumaichat.admin.settings.continue_to_reply_count_help")}),this.buildSettingComponent({type:"flarum-tags.select-tags",setting:"wszdb-flarumaichat.enabled-tags",label:n().translator.trans("wszdb-flarumaichat.admin.settings.enabled_tags_label"),help:n().translator.trans("wszdb-flarumaichat.admin.settings.enabled_tags_help"),options:{requireParentTag:!1,limits:{max:{secondary:0}}}}),m("div",{className:"Form-group"},this.submitButton()))))},s}(l());n().initializers.add("wszdb-flarumaichat",(function(){n().extensionData.for("wszdb-flarumaichat").registerPermission({label:n().translator.trans("wszdb-flarumaichat.admin.permissions.use_chatgpt_assistant_label"),icon:"fas fa-comment",permission:"discussion.useChatGPTAssistant",allowGuest:!1},"start").registerPage(u)}))})(),module.exports=a})();
//# sourceMappingURL=admin.js.map
